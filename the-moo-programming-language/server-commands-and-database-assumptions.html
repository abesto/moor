<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Server Commands and Database Assumptions - The moor Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/style.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The moor Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="server-commands-and-database-assumptions"><a class="header" href="#server-commands-and-database-assumptions">Server Commands and Database Assumptions</a></h1>
<p>This chapter describes all of the commands that are built into the server and every property and verb in the database specifically accessed by the server. Aside from what is listed here, no assumptions are made by the server concerning the contents of the database.</p>
<h2 id="command-lines-that-receive-special-treatment"><a class="header" href="#command-lines-that-receive-special-treatment">Command Lines That Receive Special Treatment</a></h2>
<p>As was mentioned in the chapter on command parsing, there are a number of commands and special prefixes whose interpretation is fixed by the server. Examples include the flush command and the five intrinsic commands (PREFIX, OUTPUTPREFIX, SUFFIX, OUTPUTSUFFIX, and .program).</p>
<p>This section discusses all of these built-in pieces of the command-interpretation process in the order in which they occur.</p>
<h3 id="flushing-unprocessed-input"><a class="header" href="#flushing-unprocessed-input">Flushing Unprocessed Input</a></h3>
<p>It sometimes happens that a user changes their mind about having typed one or more lines of input and would like to <code>untype</code> them before the server actually gets around to processing them. If they react quickly enough, they can type their connection`s defined flush command; when the server first reads that command from the network, it immediately and completely flushes any as-yet unprocessed input from that user, printing a message to the user describing just which lines of input were discarded, if any.</p>
<blockquote>
<p>Fine point: The flush command is handled very early in the server`s processing of a line of input, before the line is entered into the task queue for the connection and well before it is parsed into words like other commands. For this reason, it must be typed exactly as it was defined, alone on the line, without quotation marks, and without any spaces before or after it.</p>
</blockquote>
<p>When a connection is first accepted by the server, it is given an initial flush command setting taken from the current default. This initial setting can be changed later using the set_connection_option() command.</p>
<p>By default, each connection is initially given <code>.flush</code> as its flush command. If the property $server_options.default_flush_command exists, then its value overrides this default. If $server_options.default_flush_command is a non-empty string, then that string is the flush command for all new connections; otherwise, new connections are initially given no flush command at all.</p>
<h3 id="out-of-band-processing"><a class="header" href="#out-of-band-processing">Out-of-Band Processing</a></h3>
<p>It is possible to compile the server to recognize an out-of-band prefix and an out-of-band quoting prefix for input lines. These are strings that the server will check for at the beginning of every unflushed line of input from a non-binary connection, regardless of whether or not a player is logged in and regardless of whether or not reading tasks are waiting for input on that connection.</p>
<p>This check can be disabled entirely by setting connection option "disable-oob", in which case none of the rest of this section applies, i.e., all subsequent unflushed lines on that connection will be available unchanged for reading tasks or normal command parsing.</p>
<h3 id="quoted-lines"><a class="header" href="#quoted-lines">Quoted Lines</a></h3>
<p>We first describe how to ensure that a given input line will not be processed as an out-of-band command.</p>
<p>If a given line of input begins with the defined out-of-band quoting prefix (<code>#$"</code> by default), that prefix is stripped. The resulting line is then available to reading tasks or normal command parsing in the usual way, even if said resulting line now happens to begin with either the out-of-band prefix or the out-of-band quoting prefix.</p>
<p>For example, if a player types</p>
<pre><code>#$"#$#mcp-client-set-type fancy
</code></pre>
<p>the server would behave exactly as if connection option "disable-oob" were set true and the player had instead typed</p>
<pre><code>#$#mcp-client-set-type fancy
</code></pre>
<h3 id="commands"><a class="header" href="#commands">Commands</a></h3>
<p>If a given line of input begins with the defined out-of-band prefix (<code>#$#</code> by default), then it is not treated as a normal command or given as input to any reading task. Instead, the line is parsed into a list of words in the usual way and those words are given as the arguments in a call to $do_out_of_band_command().</p>
<p>If this verb does not exist or is not executable, the line in question will be completely ignored.</p>
<p>For example, with the default out-of-band prefix, the line of input</p>
<pre><code>#$#mcp-client-set-type fancy
</code></pre>
<p>would result in the following call being made in a new server task:</p>
<pre><code>$do_out_of_band_command("#$#mcp-client-set-type", "fancy")
</code></pre>
<p>During the call to $do_out_of_band_command(), the variable player is set to the object number representing the player associated with the connection from which the input line came. Of course, if that connection has not yet logged in, the object number will be negative. Also, the variable argstr will have as its value the unparsed input line as received on the network connection.</p>
<p>Out-of-band commands are intended for use by advanced client programs that may generate asynchronous events of which the server must be notified. Since the client cannot, in general, know the state of the player`s connection (logged-in or not, reading task or not), out-of-band commands provide the only reliable client-to-server communications channel.</p>
<p><a href="http://www.faqs.org/rfcs/rfc854.html">Telnet IAC</a> commands will also get captured and passed, as binary strings, to a <code>do_out_of_band_command</code> verb on the listener.</p>
<h3 id="command-output-delimiters"><a class="header" href="#command-output-delimiters">Command-Output Delimiters</a></h3>
<blockquote>
<p>Warning: This is a deprecated feature</p>
</blockquote>
<p>Every MOO network connection has associated with it two strings, the <code>output prefix</code> and the <code>output suffix</code>. Just before executing a command typed on that connection, the server prints the output prefix, if any, to the player. Similarly, just after finishing the command, the output suffix, if any, is printed to the player. Initially, these strings are not defined, so no extra printing takes place.</p>
<p>The <code>PREFIX</code> and <code>SUFFIX</code> commands are used to set and clear these strings. They have the following simple syntax:</p>
<pre><code>PREFIX  output-prefix
SUFFIX  output-suffix
</code></pre>
<p>That is, all text after the command name and any following spaces is used as the new value of the appropriate string. If there is no non-blank text after the command string, then the corresponding string is cleared. For compatibility with some general MUD client programs, the server also recognizes <code>OUTPUTPREFIX</code> as a synonym for <code>PREFIX</code> and <code>OUTPUTSUFFIX</code> as a synonym for <code>SUFFIX</code>.</p>
<p>These commands are intended for use by programs connected to the MOO, so that they can issue MOO commands and reliably determine the beginning and end of the resulting output. For example, one editor-based client program sends this sequence of commands on occasion:</p>
<pre><code>PREFIX &gt;&gt;MOO-Prefix&lt;&lt;
SUFFIX &gt;&gt;MOO-Suffix&lt;&lt;
@list object:verb without numbers
PREFIX
SUFFIX
</code></pre>
<p>The effect of which, in a ToastCore-derived database, is to print out the code for the named verb preceded by a line containing only <code>&gt;&gt;MOO-Prefix&lt;&lt;</code> and followed by a line containing only <code>&gt;&gt;MOO-Suffix&lt;&lt;</code>. This enables the editor to reliably extract the program text from the MOO output and show it to the user in a separate editor window. There are many other possible uses.</p>
<blockquote>
<p>Warning: If the command thus bracketed calls suspend(), its output will be deemed “finished” then and there; the suffix thus appears at that point and not, as one might expect, later when the resulting background task has finally returned from its top-level verb call. Thus, use of this feature (which was designed before suspend() existed) is no longer recommended.</p>
</blockquote>
<p>The built-in function <code>output_delimiters()</code> can be used by MOO code to find out the output prefix and suffix currently in effect on a particular network connection.</p>
<h2 id="the-program-command"><a class="header" href="#the-program-command">The .program Command</a></h2>
<p>The <code>.program</code> command is a common way for programmers to associate a particular MOO-code program with a particular verb. It has the following syntax:</p>
<pre><code>.program object:verb
...several lines of MOO code...
.
</code></pre>
<p>That is, after typing the <code>.program</code> command, then all lines of input from the player are considered to be a part of the MOO program being defined. This ends as soon as the player types a line containing only a dot (<code>.</code>). When that line is received, the accumulated MOO program is checked for proper MOO syntax and, if correct, associated with the named verb.</p>
<p>If, at the time the line containing only a dot is processed, (a) the player is not a programmer, (b) the player does not have write permission on the named verb, or (c) the property <code>$server_options.protect_set_verb_code</code> exists and has a true value and the player is not a wizard, then an error message is printed and the named verb's program is not changed.</p>
<p>In the <code>.program</code> command, object may have one of three forms:</p>
<ul>
<li>The name of some object visible to the player. This is exactly like the kind of matching done by the server for the direct and indirect objects of ordinary commands. See the chapter on command parsing for details. Note that the special names <code>me</code> and <code>here</code> may be used.</li>
<li>An object number, in the form <code>#number</code>.</li>
<li>A <em>system property</em> (that is, a property on <code>#0</code>), in the form <code>$name</code>. In this case, the current value of <code>#0.name</code> must be a valid object.</li>
</ul>
<h2 id="initial-punctuation-in-commands"><a class="header" href="#initial-punctuation-in-commands">Initial Punctuation in Commands</a></h2>
<p>The server interprets command lines that begin with any of the following characters specially:</p>
<pre><code>"        :        ;
</code></pre>
<p>Before processing the command, the initial punctuation character is replaced by the corresponding word below, followed by a space:</p>
<pre><code>say      emote    eval
</code></pre>
<p>For example, the command line</p>
<pre><code>"Hello, there.
</code></pre>
<p>is transformed into</p>
<pre><code>say Hello, there.
</code></pre>
<p>before parsing.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../the-moo-programming-language/built-in-functions/manipulating-objects.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../the-moo-programming-language/server-assumptions-about-the-database.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../the-moo-programming-language/built-in-functions/manipulating-objects.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../the-moo-programming-language/server-assumptions-about-the-database.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/moo-syntax-highlight.js"></script>


    </div>
    </body>
</html>
